---
layout: default
title: Anomaly detection security
nav_order: 10
parent: Anomaly detection
has_children: false
---

# Anomaly detection security

You can use the security plugin with anomaly detection in OpenSearch to limit non-admin users to specific actions. For example, you might want some users to only be able to create, update, or delete detectors, while others to only view detectors.

All anomaly detection indices are protected as system indices. Only a super admin user or an admin user with a TLS certificate can access system indices. For more information, see [System indices]({{site.url}}{{site.baseurl}}/security-plugin/configuration/system-indices/).


Security for anomaly detection works the same as [security for alerting]({{site.url}}{{site.baseurl}}/monitoring-plugins/alerting/security/).

## Basic permissions

As an admin user, you can use the security plugin to assign specific permissions to users based on which APIs they need access to. For a list of supported APIs, see [Anomaly detection API]({{site.url}}{{site.baseurl}}/monitoring-plugins/ad/api/).

The security plugin has two built-in roles that cover most anomaly detection use cases: `anomaly_full_access` and `anomaly_read_access`. For descriptions of each, see [Predefined roles]({{site.url}}{{site.baseurl}}/security-plugin/access-control/users-roles#predefined-roles).

If these roles don't meet your needs, mix and match individual anomaly detection [permissions]({{site.url}}{{site.baseurl}}/security-plugin/access-control/permissions/) to suit your use case. Each action corresponds to an operation in the REST API. For example, the `cluster:admin/opensearch/ad/detector/delete` permission lets you delete detectors.

### A note on role based access control and sharing detectors

By design, the Anomaly Detection plugin must extract data from a target index and store it to its own system indexes before it can detect anomaly conditions and send alerts. As such, users who have access permission to the plugin’s detectors will necessarily have some degree of access to the information it analyzes, whether that’s in the detector itself or a notification generated by an anomaly condition.

Once a detector contains data derived from a target index, it can potentially lead to cases where the detector or a notification provides a user with implicit description of documents and fields in a target index that would otherwise be hidden from that user by [document-level security]({{site.url}}{{site.baseurl}}/security-plugin/access-control/document-level-security/) (DLS) and [field-level security]({{site.url}}{{site.baseurl}}/security-plugin/access-control/field-level-security/) (FLS) access controls. This can happen, for example, when one user creates a detector and inadvertently shares it with another in the same group who also happens to have an additional role that specifies DLS or FLS controls for the target index.

To prevent this from happening, OpenSearch recommends that users responsible for defining detectors take precautions to avoid giving other users access permissions to the detector when it is set up to analyze an index that contains data restricted by DLS and FLS. Administrators will therefore need to keep these kinds of conflicts in mind when assigning permissions to an intended group of users.

To learn more about using role based access control to reduce chances of this situation happening, see the section [Limit access by backend role](#advanced-limit-access-by-backend-role) immediately following this note.

## (Advanced) Limit access by backend role

Use backend roles to configure fine-grained access to individual detectors based on roles. For example, users of different departments in an organization can view detectors owned by their own department.

First, make sure your users have the appropriate [backend roles]({{site.url}}{{site.baseurl}}/security-plugin/access-control/index/). Backend roles usually come from an [LDAP server]({{site.url}}{{site.baseurl}}/security-plugin/configuration/ldap/) or [SAML provider]({{site.url}}{{site.baseurl}}/security-plugin/configuration/saml/), but if you use the internal user database, you can use the REST API to [add them manually]({{site.url}}{{site.baseurl}}/security-plugin/access-control/api#create-user).

Next, enable the following setting:

```json
PUT _cluster/settings
{
  "transient": {
    "plugins.anomaly_detection.filter_by_backend_roles": "true"
  }
}
```

Now when users view anomaly detection resources in OpenSearch Dashboards (or make REST API calls), they only see detectors created by users who share at least one backend role.
For example, consider two users: `alice` and `bob`.

`alice` has an analyst backend role:

```json
PUT _plugins/_security/api/internalusers/alice
{
  "password": "alice",
  "backend_roles": [
    "analyst"
  ],
  "attributes": {}
}
```

`bob` has a human-resources backend role:

```json
PUT _plugins/_security/api/internalusers/bob
{
  "password": "bob",
  "backend_roles": [
    "human-resources"
  ],
  "attributes": {}
}
```

Both `alice` and `bob` have full access to anomaly detection:

```json
PUT _plugins/_security/api/rolesmapping/anomaly_full_access
{
  "backend_roles": [],
  "hosts": [],
  "users": [
    "alice",
    "bob"
  ]
}
```

Because they have different backend roles, `alice` and `bob` cannot view each other's detectors or their results.
