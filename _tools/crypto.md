---
layout: default
title: Crypto plugin
nav_order: 90
has_children: false
---


# Crypto plugin

The Crypto plugin provides client side encryption and decryption for OpenSearch. This allows for the encryption of data transferred between OpenSearch and a remote storage service to support features such as [Remote-backed storage]({{site.url}}{{site.baseurl}}/tuning-your-cluster/availability-and-recovery/remote-store/index/) or backup of [Snapshots]({{site.url}}{{site.baseurl}}/tuning-your-cluster/availability-and-recovery/snapshots/index/). However, the plugin is not limited to this type of application alone and can be used for local encryption as well.

Using the plugin to encrypt data sill requires a cypher key—also called a data key—and a key provider service to generate it. The plugin is extensible and therefore supports any number of key providers.

## Terms

The following table includes terms that are relevant to the Crypto plugin and its process.

| Term | Definition |
| :--- | :--- |
| Data key | A cipher or cryptographic key generated by a key provider.  |
| Repository | A container for storing encrypted data.  |
|  | A c  |


## Hi-level process for encryption

The Crypto plugin is responsible for encrypting and decrypting data moving to and from OpenSearch. It relies on a key provider to generate the data keys and rotate them at regular intervals. This section provides a high-level overview of the basic encryption process.

1. Upon launch of OpenSearch, the Crypto plugin is loaded and, in turn, loads available extensions for unique key providers.
1. The user registers a repository that will be used to contain encrypted data. Registration of the repository involves sending a request that includes a plugin configuration. The configuration specifies settings for both remote storage services (if this applies) and key providers. For more information about the configuration, see [Registering a repository].

The configuration includes the ability to enable or disable encryption. Once a repository is registered and enabled, it cannot be disabled. Likewise, after a repository has been registered as disabled, it cannot be enabled for encryption. 
{: .important }

1. Based on the configuration, the plugin registers the key providers, which begins the process of generating refreshed key pairs at regular intervals. These new key pairs are cached in the Crypto plugin.
1. 

### Request fields

| Field | Type | Description |
| :--- | :--- |:--- |
| `type` | String | The storage service used to store the repository. |
| `settings.bucket` | String | Path to the target distinguished name to be updated. Required. |
| `settings.region` | String | Path to the target distinguished name to be updated. Required. |
| `encrypted` | Boolean | Determines whether the repository is encrypted or not. Set to `true` to encrypt the repository. |
| `crypto_settings.key_provider_name` | String | Identifies the key provider. |
| `crypto_settings.key_provider_type` | String | The type of extension installed |
| `crypto_settings.key_provider_type.settings.sample_key_arn` | String | Setting for the extension plugin that creates the key provider. |



#### Example request

```json
PUT _snapshot/vikasvb-repository-test-1
{
  "type": "s3",
  "settings": {
    "bucket": "vikasvb-repository-test",
    "region": "us-west-2"
  },    
  "encrypted": true,
  "crypto_settings": {
      "key_provider_name": "first-mock-1",
      "key_provider_type": "sample-key-provider-extension",
      "settings": {
          "key-1": "sample value"
      }
  }
}
```
{% include copy-curl.html %}

#### Example response

```json
{
    "acknowledged": true
}
```

## External libraries

Software dependencies are mainly AWS v2 SDK. The following is a list of dependencies:

1. AWS encryption SDK (com.amazonaws:aws-encryption-sdk-java) - Some classes are modified to support encryption or decryption of partial content.
2. Bouncy castle (org.bouncycastle:bcprov-ext-jdk15on)  : Used by encryption SDK for core crypto ops.
3. Apache commons (org.apache.commons:commons-lang3) - Again used by encryption SDK for basic object validations.
4. Junit dependencies - For tests